(function(t){function n(n){for(var e,s,a=n[0],h=n[1],c=n[2],u=0,f=[];u<a.length;u++)s=a[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&f.push(o[s][0]),o[s]=0;for(e in h)Object.prototype.hasOwnProperty.call(h,e)&&(t[e]=h[e]);l&&l(n);while(f.length)f.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,n=0;n<r.length;n++){for(var i=r[n],e=!0,a=1;a<i.length;a++){var h=i[a];0!==o[h]&&(e=!1)}e&&(r.splice(n--,1),t=s(s.s=i[0]))}return t}var e={},o={app:0},r=[];function s(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,n,i){s.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,n){if(1&n&&(t=s(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)s.d(i,e,function(n){return t[n]}.bind(null,e));return i},s.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(n,"a",n),n},s.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},s.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],h=a.push.bind(a);a.push=n,a=a.slice();for(var c=0;c<a.length;c++)n(a[c]);var l=h;r.push([0,"chunk-vendors"]),i()})({0:function(t,n,i){t.exports=i("56d7")},"56d7":function(t,n,i){"use strict";i.r(n);i("cadf"),i("551c"),i("f751"),i("097d");var e=i("2b0e"),o=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},r=[],s=i("2877"),a={},h=Object(s["a"])(a,o,r,!1,null,null,null),c=h.exports,l=i("8c4f"),u=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("q-layout",{attrs:{view:"lHh Lpr lFf"}},[i("q-header",{staticClass:"glossy",attrs:{elevated:""}},[i("q-toolbar",[i("q-btn",{attrs:{flat:"",dense:"",round:"","aria-label":"Menu",icon:"menu"},on:{click:function(n){t.leftDrawerOpen=!t.leftDrawerOpen}}})],1)],1),i("q-drawer",{attrs:{bordered:"","content-class":"bg-grey-2"},model:{value:t.leftDrawerOpen,callback:function(n){t.leftDrawerOpen=n},expression:"leftDrawerOpen"}},[i("q-list",[i("q-item-label",{attrs:{header:""}},[t._v("建国-路由")]),i("q-item",{attrs:{to:"/",exact:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"home"}})],1),i("q-item-section",[i("q-item-label",[t._v("五子棋")])],1)],1),i("q-item",{attrs:{to:"/magic_cube",exact:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"info"}})],1),i("q-item-section",[i("q-item-label",[t._v("魔方")])],1)],1),i("q-item",{attrs:{to:"/about",exact:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"info"}})],1),i("q-item-section",[i("q-item-label",[t._v("控制台")])],1)],1)],1)],1),i("q-page-container",[i("router-view")],1)],1)},f=[],m={name:"LayoutDefault",data:function(){return{leftDrawerOpen:this.$q.platform.is.desktop}}},p=m,d=Object(s["a"])(p,u,f,!1,null,null,null),g=d.exports,y=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{staticClass:"index"},[i("q-toolbar",{attrs:{color:"amber"}},[i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"mail"},on:{click:function(n){t.rightDrawerOpen=!t.rightDrawerOpen}}})],1),i("q-card",{staticClass:"qi_pan"},[i("p",{staticClass:"text-negative"},[t._v("下一步: "+t._s(t.nextStep))]),i("p",{staticClass:"text-tertiary"},[t._v("当前在线人数: "+t._s(t.userOnline))]),i("p",{staticClass:"text-primary"},[t._v("你的身份: "+t._s(t.yourID))]),i("p",{staticClass:"text-warning"},[t._v("房间人数到达两人即可开始对战, 不能悔棋")]),i("q-btn",{attrs:{glossy:"",color:"primary",label:"再来一局",disabled:"观战者"===t.yourID},on:{click:t.restart}}),i("div",{staticClass:"relative-position"},[i("table",{attrs:{id:"qi_pan_table"}},t._l(t.qipan_arr,(function(n,e){return i("tr",{key:e},t._l(n,(function(n,o){return i("td",{key:o},[i("span","黑方"===n?{class:t.positionFormatter(e,o)?"on":null,staticStyle:{background:"black"}}:"白方"===n?{class:t.positionFormatter(e,o)?"on":null,staticStyle:{background:"white"}}:{on:{click:function(n){return t.xiaqi(e,o)}}})])})),0)})),0),i("q-inner-loading",{attrs:{showing:t.visible}},[i("q-spinner-ball",{attrs:{size:"50px",color:"primary"}}),t._v("\n        "+t._s(t.battleResult)+"\n      ")],1)],1)],1),i("q-drawer",{attrs:{side:"right",bordered:"","content-class":"bg-grey-2 chat","content-style":"padding: 1rem;"},model:{value:t.rightDrawerOpen,callback:function(n){t.rightDrawerOpen=n},expression:"rightDrawerOpen"}},[i("q-chat-message",{attrs:{label:t.today}}),t._l(t.chatArr,(function(n,e){return i("q-chat-message",{key:e,attrs:{name:n.ID,avatar:n.imgUrl,text:[n.text],stamp:t.dateFormatter(n.date),sent:t.yourID===n.ID}})})),i("q-input",{staticClass:"chatInput",model:{value:t.chatContent,callback:function(n){t.chatContent=n},expression:"chatContent"}},[i("q-btn",{attrs:{color:"primary",size:"md",label:"发送"},on:{click:t.submitMessage}})],1)],2)],1)},x=[],v=(i("7f7f"),i("6762"),i("2fdb"),{name:"home",data:function(){return{nextStep:"黑方",userOnline:"1",yourID:"黑方",qipan_arr:[],chatContent:"",chatArr:[],rightDrawerOpen:!0,positionNow:[],visible:!1,battleResult:""}},created:function(){for(var t=0;t<18;t++){for(var n=[],i=0;i<18;i++)n.push(i);this.qipan_arr.push(n)}},computed:{today:function(){var t=new Date,n=t.getFullYear(),i=t.getMonth()+1<10?"0".concat(t.getMonth()+1):t.getMonth()+1,e=t.getDate();return"".concat(n,"-").concat(i,"-").concat(e)}},mounted:function(){"WebSocket"in window?(this.startXiaQiWs(),this.startChatWs()):console.error("您的浏览器不支持 WebSocket!"),this.$nextTick((function(){for(var t=document.querySelectorAll("#qi_pan_table>tr>td"),n=0;n<t.length;n++)t[n].style.height=t[n].offsetWidth+"px"}))},methods:{waitConfirm:function(t,n){var i=this,e=!1;this.$q.dialog({title:"来自建国的通知",message:t,ok:"同意",cancel:"不同意"}).onOk((function(){e=!0})).onCancel((function(){e=!1})).onDismiss((function(){i.ajax("POST","/isAgree",{isAgree:e,ID:n,yourID:i.yourID},(function(t){console.log(t)}))}))},otherPartyAgree:function(t){this.$q.dialog({title:"来自建国的提示",message:t})},ajax:function(t,n,i,e){var o=new XMLHttpRequest;o.open(t,"http://10.10.16.92:3000".concat(n),!0),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify(i)),o.onreadystatechange=function(){200===o.status&&4===o.readyState&&e(JSON.parse(o.responseText))}},restart:function(){var t=this.qipan_arr.reduce((function(t,n){for(var i=0;i<n.length;i++)"黑方"!==n[i]&&"白方"!==n[i]||(t+=1);return t}),0);t<5?this.$q.notify("多走几步吧， 求求你了"):this.ajax("POST","/restart",{ID:this.yourID},(function(t){console.log(t)}))},positionFormatter:function(t,n){return 2===this.positionNow.length&&(this.positionNow[0]===t&&this.positionNow[1]===n)},dateFormatter:function(t){var n=new Date(t),i=n.getHours()>=10?n.getHours():"0".concat(n.getHours()),e=n.getMinutes()>=10?n.getMinutes():"0".concat(n.getMinutes()),o=n.getSeconds()>=10?n.getSeconds():"0".concat(n.getSeconds());return"".concat(i,":").concat(e,":").concat(o)},submitMessage:function(){""!==this.chatContent.trim()?(this.chatWs.send(JSON.stringify({ID:this.yourID,text:this.chatContent,date:new Date,imgUrl:"黑方"===this.yourID?"img/img1.jpg":"img/img2.jpg"})),this.chatContent=""):this.$q.notify({message:"请勿发送空消息!",timeout:3e3,color:"yellow",textColor:"black",position:"top-right"})},xiaqi:function(t,n){if("观战者"===this.yourID)return alert(""),void this.$q.notify({message:"你是观战者， 不要动,  看就好了",timeout:3e3,color:"yellow",textColor:"black",position:"top-left"});this.yourID.includes(this.nextStep)?(this.nextStep="黑方"===this.nextStep?"白方":"黑方",this.xiaQiWs.send(JSON.stringify({ID:this.yourID,next:this.nextStep,position:[t,n]}))):this.$q.notify({message:"请先等待对手落子".concat(t,"-").concat(n),timeout:3e3,color:"yellow",textColor:"black",position:"top-left"})},startChatWs:function(){var t=this;this.chatWs=new WebSocket("ws://10.10.16.92:3000/chat"),this.chatWs.onopen=function(){console.info("聊天连接已打开")},this.chatWs.onmessage=function(n){var i=JSON.parse(n.data);t.chatArr=i.chatArr,t.rightDrawerOpen=!0},this.chatWs.onclose=function(){console.info("聊天连接已关闭...")}},startXiaQiWs:function(){var t=this;this.xiaQiWs=new WebSocket("ws://10.10.16.92:3000/battle"),this.xiaQiWs.onopen=function(){console.info("下棋连接已打开")},this.xiaQiWs.onmessage=function(n){var i=JSON.parse(n.data);i.isAgain?"观战者"!==t.yourID&&t.yourID!==i.ID&&t.waitConfirm(i.msg,i.ID):i.isAgree?t.yourID===i.ID&&t.otherPartyAgree(i.msg):(i.battleResult&&(t.battleResult=i.battleResult,t.visible=!0),t.qipan_arr=i.arr,t.positionNow=i.position,t.nextStep=i.title,t.userOnline=i.userOnline,i.name&&(t.yourID=i.name))},this.xiaQiWs.onclose=function(){console.info("下棋连接已关闭...")}}}}),b=v,M=(i("a9a9"),Object(s["a"])(b,y,x,!1,null,"5b81d948",null)),w=M.exports,S=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{staticClass:"magicCube"},[t._v("\n  magic cube\n")])},_=[],R={name:"magicCube",data:function(){return{}},created:function(){},computed:{},mounted:function(){},methods:{}},z=R,A=(i("c25a"),Object(s["a"])(z,S,_,!1,null,"67228906",null)),L=A.exports,C=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("q-page",{attrs:{padding:""}},[i("div",{attrs:{id:"indexLizi"}}),i("p",[t._v("开发中....")])])},P=[],E=(i("af56"),i("63d9"),i("6c7b"),i("55dd"),i("6b54"),i("673e"),E||{});E.Color=function(t){this.autoUpdate=!0,this.setHex(t)},E.Color.prototype={setRGBA:function(t,n,i,e){this.r=t,this.g=n,this.b=i,this.a=e,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(t){this.hex=t,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},copyRGB:function(t){this.r=t.r,this.g=t.g,this.b=t.b},copyRGBA:function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},multiplySelfRGB:function(t){this.r*=t.r,this.g*=t.g,this.b*=t.b},updateHex:function(){this.hex=Math.floor(255*this.a)<<24|Math.floor(255*this.r)<<16|Math.floor(255*this.g)<<8|Math.floor(255*this.b)},updateRGBA:function(){this.a=(this.hex>>24&255)/255,this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+this.a+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", a: "+this.a+", hex: "+this.hex+" )"}},E.Vector2=function(t,n){this.x=t||0,this.y=n||0},E.Vector2.prototype={set:function(t,n){return this.x=t,this.y=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new E.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},E.Vector3=function(t,n,i){this.x=t||0,this.y=n||0,this.z=i||0},E.Vector3.prototype={set:function(t,n,i){return this.x=t,this.y=n,this.z=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},cross:function(t,n){return this.x=t.y*n.z-t.z*n.y,this.y=t.z*n.x-t.x*n.z,this.z=t.x*n.y-t.y*n.x,this},crossSelf:function(t){var n=this.x,i=this.y,e=this.z;return this.x=i*t.z-e*t.y,this.y=e*t.x-n*t.z,this.z=n*t.y-i*t.x,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var n=this.x-t.x,i=this.y-t.y,e=this.z-t.z;return n*n+i*i+e*e},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.length()>0?this.multiplyScalar(1/this.length()):this.multiplyScalar(0),this},setLength:function(t){return this.normalize().multiplyScalar(t)},isZero:function(){var t=1e-4;return Math.abs(this.x)<t&&Math.abs(this.y)<t&&Math.abs(this.z)<t},clone:function(){return new E.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},E.Vector4=function(t,n,i,e){this.x=t||0,this.y=n||0,this.z=i||0,this.w=e||1},E.Vector4.prototype={set:function(t,n,i,e){return this.x=t,this.y=n,this.z=i,this.w=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},add:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},clone:function(){return new E.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},E.Rectangle=function(){var t,n,i,e,o,r,s=!0;function a(){o=i-t,r=e-n}this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return o},this.getHeight=function(){return r},this.getX1=function(){return t},this.getY1=function(){return n},this.getX2=function(){return i},this.getY2=function(){return e},this.set=function(o,r,h,c){s=!1,t=o,n=r,i=h,e=c,a()},this.addPoint=function(o,r){s?(s=!1,t=o,n=r,i=o,e=r):(t=Math.min(t,o),n=Math.min(n,r),i=Math.max(i,o),e=Math.max(e,r)),a()},this.addRectangle=function(o){s?(s=!1,t=o.getX1(),n=o.getY1(),i=o.getX2(),e=o.getY2()):(t=Math.min(t,o.getX1()),n=Math.min(n,o.getY1()),i=Math.max(i,o.getX2()),e=Math.max(e,o.getY2())),a()},this.inflate=function(o){t-=o,n-=o,i+=o,e+=o,a()},this.minSelf=function(o){t=Math.max(t,o.getX1()),n=Math.max(n,o.getY1()),i=Math.min(i,o.getX2()),e=Math.min(e,o.getY2()),a()},this.instersects=function(o){return Math.min(i,o.getX2())-Math.max(t,o.getX1())>=0&&Math.min(e,o.getY2())-Math.max(n,o.getY1())>=0},this.empty=function(){s=!0,t=0,n=0,i=0,e=0,a()},this.isEmpty=function(){return s},this.toString=function(){return"THREE.Rectangle (x1: "+t+", y1: "+e+", x2: "+i+", y1: "+n+", width: "+o+", height: "+r+")"}},E.Matrix3=function(){this.m=[]},E.Matrix3.prototype={transpose:function(){var t;return t=this.m[1],this.m[1]=this.m[3],this.m[3]=t,t=this.m[2],this.m[2]=this.m[6],this.m[6]=t,t=this.m[5],this.m[5]=this.m[7],this.m[7]=t,this}},E.Matrix4=function(){this._x=new E.Vector3,this._y=new E.Vector3,this._z=new E.Vector3},E.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1},copy:function(t){this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44},lookAt:function(t,n,i){var e=this._x,o=this._y,r=this._z;r.sub(t,n),r.normalize(),e.cross(i,r),e.normalize(),o.cross(r,e),o.normalize(),this.n11=e.x,this.n12=e.y,this.n13=e.z,this.n14=-e.dot(t),this.n21=o.x,this.n22=o.y,this.n23=o.z,this.n24=-o.dot(t),this.n31=r.x,this.n32=r.y,this.n33=r.z,this.n34=-r.dot(t),this.n41=0,this.n42=0,this.n43=0,this.n44=1},transform:function(t){var n=t.x,i=t.y,e=t.z,o=t.w?t.w:1;return t.x=this.n11*n+this.n12*i+this.n13*e+this.n14*o,t.y=this.n21*n+this.n22*i+this.n23*e+this.n24*o,t.z=this.n31*n+this.n32*i+this.n33*e+this.n34*o,o=this.n41*n+this.n42*i+this.n43*e+this.n44*o,t.w?t.w=o:(t.x=t.x/o,t.y=t.y/o,t.z=t.z/o),t},crossVector:function(t){var n=new E.Vector4;return n.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,n.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,n.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,n.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,n},multiply:function(t,n){this.n11=t.n11*n.n11+t.n12*n.n21+t.n13*n.n31+t.n14*n.n41,this.n12=t.n11*n.n12+t.n12*n.n22+t.n13*n.n32+t.n14*n.n42,this.n13=t.n11*n.n13+t.n12*n.n23+t.n13*n.n33+t.n14*n.n43,this.n14=t.n11*n.n14+t.n12*n.n24+t.n13*n.n34+t.n14*n.n44,this.n21=t.n21*n.n11+t.n22*n.n21+t.n23*n.n31+t.n24*n.n41,this.n22=t.n21*n.n12+t.n22*n.n22+t.n23*n.n32+t.n24*n.n42,this.n23=t.n21*n.n13+t.n22*n.n23+t.n23*n.n33+t.n24*n.n43,this.n24=t.n21*n.n14+t.n22*n.n24+t.n23*n.n34+t.n24*n.n44,this.n31=t.n31*n.n11+t.n32*n.n21+t.n33*n.n31+t.n34*n.n41,this.n32=t.n31*n.n12+t.n32*n.n22+t.n33*n.n32+t.n34*n.n42,this.n33=t.n31*n.n13+t.n32*n.n23+t.n33*n.n33+t.n34*n.n43,this.n34=t.n31*n.n14+t.n32*n.n24+t.n33*n.n34+t.n34*n.n44,this.n41=t.n41*n.n11+t.n42*n.n21+t.n43*n.n31+t.n44*n.n41,this.n42=t.n41*n.n12+t.n42*n.n22+t.n43*n.n32+t.n44*n.n42,this.n43=t.n41*n.n13+t.n42*n.n23+t.n43*n.n33+t.n44*n.n43,this.n44=t.n41*n.n14+t.n42*n.n24+t.n43*n.n34+t.n44*n.n44},multiplySelf:function(t){var n=this.n11,i=this.n12,e=this.n13,o=this.n14,r=this.n21,s=this.n22,a=this.n23,h=this.n24,c=this.n31,l=this.n32,u=this.n33,f=this.n34,m=this.n41,p=this.n42,d=this.n43,g=this.n44;this.n11=n*t.n11+i*t.n21+e*t.n31+o*t.n41,this.n12=n*t.n12+i*t.n22+e*t.n32+o*t.n42,this.n13=n*t.n13+i*t.n23+e*t.n33+o*t.n43,this.n14=n*t.n14+i*t.n24+e*t.n34+o*t.n44,this.n21=r*t.n11+s*t.n21+a*t.n31+h*t.n41,this.n22=r*t.n12+s*t.n22+a*t.n32+h*t.n42,this.n23=r*t.n13+s*t.n23+a*t.n33+h*t.n43,this.n24=r*t.n14+s*t.n24+a*t.n34+h*t.n44,this.n31=c*t.n11+l*t.n21+u*t.n31+f*t.n41,this.n32=c*t.n12+l*t.n22+u*t.n32+f*t.n42,this.n33=c*t.n13+l*t.n23+u*t.n33+f*t.n43,this.n34=c*t.n14+l*t.n24+u*t.n34+f*t.n44,this.n41=m*t.n11+p*t.n21+d*t.n31+g*t.n41,this.n42=m*t.n12+p*t.n22+d*t.n32+g*t.n42,this.n43=m*t.n13+p*t.n23+d*t.n33+g*t.n43,this.n44=m*t.n14+p*t.n24+d*t.n34+g*t.n44},multiplyScalar:function(t){this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function t(t,n,i){var e=t[n];t[n]=t[i],t[i]=e}return t(this,"n21","n12"),t(this,"n31","n13"),t(this,"n32","n23"),t(this,"n41","n14"),t(this,"n42","n24"),t(this,"n43","n34"),this},clone:function(){var t=new E.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},E.Matrix4.translationMatrix=function(t,n,i){var e=new E.Matrix4;return e.n14=t,e.n24=n,e.n34=i,e},E.Matrix4.scaleMatrix=function(t,n,i){var e=new E.Matrix4;return e.n11=t,e.n22=n,e.n33=i,e},E.Matrix4.rotationXMatrix=function(t){var n=new E.Matrix4;return n.n22=n.n33=Math.cos(t),n.n32=Math.sin(t),n.n23=-n.n32,n},E.Matrix4.rotationYMatrix=function(t){var n=new E.Matrix4;return n.n11=n.n33=Math.cos(t),n.n13=Math.sin(t),n.n31=-n.n13,n},E.Matrix4.rotationZMatrix=function(t){var n=new E.Matrix4;return n.n11=n.n22=Math.cos(t),n.n21=Math.sin(t),n.n12=-n.n21,n},E.Matrix4.rotationAxisAngleMatrix=function(t,n){var i=new E.Matrix4,e=Math.cos(n),o=Math.sin(n),r=1-e,s=t.x,a=t.y,h=t.z;return i.n11=r*s*s+e,i.n12=r*s*a-o*h,i.n13=r*s*h+o*a,i.n21=r*s*a+o*h,i.n22=r*a*a+e,i.n23=r*a*h-o*s,i.n31=r*s*h-o*a,i.n32=r*a*h+o*s,i.n33=r*h*h+e,i},E.Matrix4.makeInvert=function(t){var n=new E.Matrix4;return n.n11=t.n23*t.n34*t.n42-t.n24*t.n33*t.n42+t.n24*t.n32*t.n43-t.n22*t.n34*t.n43-t.n23*t.n32*t.n44+t.n22*t.n33*t.n44,n.n12=t.n14*t.n33*t.n42-t.n13*t.n34*t.n42-t.n14*t.n32*t.n43+t.n12*t.n34*t.n43+t.n13*t.n32*t.n44-t.n12*t.n33*t.n44,n.n13=t.n13*t.n24*t.n42-t.n14*t.n23*t.n42+t.n14*t.n22*t.n43-t.n12*t.n24*t.n43-t.n13*t.n22*t.n44+t.n12*t.n23*t.n44,n.n14=t.n14*t.n23*t.n32-t.n13*t.n24*t.n32-t.n14*t.n22*t.n33+t.n12*t.n24*t.n33+t.n13*t.n22*t.n34-t.n12*t.n23*t.n34,n.n21=t.n24*t.n33*t.n41-t.n23*t.n34*t.n41-t.n24*t.n31*t.n43+t.n21*t.n34*t.n43+t.n23*t.n31*t.n44-t.n21*t.n33*t.n44,n.n22=t.n13*t.n34*t.n41-t.n14*t.n33*t.n41+t.n14*t.n31*t.n43-t.n11*t.n34*t.n43-t.n13*t.n31*t.n44+t.n11*t.n33*t.n44,n.n23=t.n14*t.n23*t.n41-t.n13*t.n24*t.n41-t.n14*t.n21*t.n43+t.n11*t.n24*t.n43+t.n13*t.n21*t.n44-t.n11*t.n23*t.n44,n.n24=t.n13*t.n24*t.n31-t.n14*t.n23*t.n31+t.n14*t.n21*t.n33-t.n11*t.n24*t.n33-t.n13*t.n21*t.n34+t.n11*t.n23*t.n34,n.n31=t.n22*t.n34*t.n41-t.n24*t.n32*t.n41+t.n24*t.n31*t.n42-t.n21*t.n34*t.n42-t.n22*t.n31*t.n44+t.n21*t.n32*t.n44,n.n32=t.n14*t.n32*t.n41-t.n12*t.n34*t.n41-t.n14*t.n31*t.n42+t.n11*t.n34*t.n42+t.n12*t.n31*t.n44-t.n11*t.n32*t.n44,n.n33=t.n13*t.n24*t.n41-t.n14*t.n22*t.n41+t.n14*t.n21*t.n42-t.n11*t.n24*t.n42-t.n12*t.n21*t.n44+t.n11*t.n22*t.n44,n.n34=t.n14*t.n22*t.n31-t.n12*t.n24*t.n31-t.n14*t.n21*t.n32+t.n11*t.n24*t.n32+t.n12*t.n21*t.n34-t.n11*t.n22*t.n34,n.n41=t.n23*t.n32*t.n41-t.n22*t.n33*t.n41-t.n23*t.n31*t.n42+t.n21*t.n33*t.n42+t.n22*t.n31*t.n43-t.n21*t.n32*t.n43,n.n42=t.n12*t.n33*t.n41-t.n13*t.n32*t.n41+t.n13*t.n31*t.n42-t.n11*t.n33*t.n42-t.n12*t.n31*t.n43+t.n11*t.n32*t.n43,n.n43=t.n13*t.n22*t.n41-t.n12*t.n23*t.n41-t.n13*t.n21*t.n42+t.n11*t.n23*t.n42+t.n12*t.n21*t.n43-t.n11*t.n22*t.n43,n.n44=t.n12*t.n23*t.n31-t.n13*t.n22*t.n31+t.n13*t.n21*t.n32-t.n11*t.n23*t.n32-t.n12*t.n21*t.n33+t.n11*t.n22*t.n33,n.multiplyScalar(1/t.determinant()),n},E.Matrix4.makeInvert3x3=function(t){var n,i=t.flatten(),e=new E.Matrix3,o=i[10]*i[5]-i[6]*i[9],r=-i[10]*i[1]+i[2]*i[9],s=i[6]*i[1]-i[2]*i[5],a=-i[10]*i[4]+i[6]*i[8],h=i[10]*i[0]-i[2]*i[8],c=-i[6]*i[0]+i[2]*i[4],l=i[9]*i[4]-i[5]*i[8],u=-i[9]*i[0]+i[1]*i[8],f=i[5]*i[0]-i[1]*i[4],m=i[0]*o+i[1]*a+i[2]*l;if(0==m)throw"matrix not invertible";return n=1/m,e.m[0]=n*o,e.m[1]=n*r,e.m[2]=n*s,e.m[3]=n*a,e.m[4]=n*h,e.m[5]=n*c,e.m[6]=n*l,e.m[7]=n*u,e.m[8]=n*f,e},E.Matrix4.makeFrustum=function(t,n,i,e,o,r){var s,a,h,c,l,u,f;return s=new E.Matrix4,a=2*o/(n-t),h=2*o/(e-i),c=(n+t)/(n-t),l=(e+i)/(e-i),u=-(r+o)/(r-o),f=-2*r*o/(r-o),s.n11=a,s.n12=0,s.n13=c,s.n14=0,s.n21=0,s.n22=h,s.n23=l,s.n24=0,s.n31=0,s.n32=0,s.n33=u,s.n34=f,s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},E.Matrix4.makePerspective=function(t,n,i,e){var o,r,s,a;return o=i*Math.tan(t*Math.PI/360),r=-o,s=r*n,a=o*n,E.Matrix4.makeFrustum(s,a,r,o,i,e)},E.Matrix4.makeOrtho=function(t,n,i,e,o,r){var s,a,h,c,l,u,f;return s=new E.Matrix4,l=n-t,u=e-i,f=r-o,a=(n+t)/l,h=(e+i)/u,c=(r+o)/f,s.n11=2/l,s.n12=0,s.n13=0,s.n14=-a,s.n21=0,s.n22=2/u,s.n23=0,s.n24=-h,s.n31=0,s.n32=0,s.n33=-2/f,s.n34=-c,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},E.Vertex=function(t,n){this.position=t||new E.Vector3,this.positionWorld=new E.Vector3,this.positionScreen=new E.Vector3,this.normal=n||new E.Vector3,this.normalWorld=new E.Vector3,this.normalScreen=new E.Vector3,this.__visible=!0},E.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},E.Face3=function(t,n,i,e,o){this.a=t,this.b=n,this.c=i,this.centroid=new E.Vector3,this.normal=e instanceof E.Vector3?e:new E.Vector3,this.vertexNormals=e instanceof Array?e:[],this.material=o instanceof Array?o:[o]},E.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},E.Face4=function(t,n,i,e,o,r){this.a=t,this.b=n,this.c=i,this.d=e,this.centroid=new E.Vector3,this.normal=o instanceof E.Vector3?o:new E.Vector3,this.vertexNormals=o instanceof Array?o:[],this.material=r instanceof Array?r:[r]},E.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},E.UV=function(t,n){this.u=t||0,this.v=n||0},E.UV.prototype={copy:function(t){this.u=t.u,this.v=t.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},E.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[]},E.Geometry.prototype={computeCentroids:function(){var t,n,i;for(t=0,n=this.faces.length;t<n;t++)i=this.faces[t],i.centroid.set(0,0,0),i instanceof E.Face3?(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.divideScalar(3)):i instanceof E.Face4&&(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.addSelf(this.vertices[i.d].position),i.centroid.divideScalar(4))},computeNormals:function(t){var n,i,e,o,r,s,a,h,c,l,u,f=new E.Vector3,m=new E.Vector3;for(e=0,o=this.vertices.length;e<o;e++)r=this.vertices[e],r.normal.set(0,0,0);for(s=0,a=this.faces.length;s<a;s++)if(h=this.faces[s],t&&h.vertexNormals.length){for(f.set(0,0,0),n=0,i=h.normal.length;n<i;n++)f.addSelf(h.vertexNormals[n]);f.divideScalar(3),f.isZero()||f.normalize(),h.normal.copy(f)}else c=this.vertices[h.a],l=this.vertices[h.b],u=this.vertices[h.c],f.sub(u.position,l.position),m.sub(c.position,l.position),f.crossSelf(m),f.isZero()||f.normalize(),h.normal.copy(f)},computeBoundingBox:function(){if(this.vertices.length>0){this.bbox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,n=this.vertices.length;t<n;t++)vertex=this.vertices[t],vertex.position.x<this.bbox.x[0]?this.bbox.x[0]=vertex.position.x:vertex.position.x>this.bbox.x[1]&&(this.bbox.x[1]=vertex.position.x),vertex.position.y<this.bbox.y[0]?this.bbox.y[0]=vertex.position.y:vertex.position.y>this.bbox.y[1]&&(this.bbox.y[1]=vertex.position.y),vertex.position.z<this.bbox.z[0]?this.bbox.z[0]=vertex.position.z:vertex.position.z>this.bbox.z[1]&&(this.bbox.z[1]=vertex.position.z)}},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+" )"}},E.Camera=function(t,n,i,e){this.fov=t,this.aspect=n,this.position=new E.Vector3(0,0,0),this.target={position:new E.Vector3(0,0,0)},this.projectionMatrix=E.Matrix4.makePerspective(t,n,i,e),this.up=new E.Vector3(0,1,0),this.matrix=new E.Matrix4,this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},E.Light=function(t){this.color=new E.Color(255<<24|t)},E.AmbientLight=function(t){E.Light.call(this,t)},E.AmbientLight.prototype=new E.Light,E.AmbientLight.prototype.constructor=E.AmbientLight,E.DirectionalLight=function(t,n){E.Light.call(this,t),this.position=new E.Vector3(0,1,0),this.intensity=n||1},E.DirectionalLight.prototype=new E.Light,E.DirectionalLight.prototype.constructor=E.DirectionalLight,E.PointLight=function(t,n){E.Light.call(this,t),this.position=new E.Vector3(0,0,0),this.intensity=n||1},E.DirectionalLight.prototype=new E.Light,E.DirectionalLight.prototype.constructor=E.PointLight,E.Object3D=function(t){this.position=new E.Vector3,this.rotation=new E.Vector3,this.scale=new E.Vector3(1,1,1),this.matrix=new E.Matrix4,this.matrixTranslation=new E.Matrix4,this.matrixRotation=new E.Matrix4,this.matrixScale=new E.Matrix4,this.screen=new E.Vector3,this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrixPosition=E.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.matrixRotation=E.Matrix4.rotationXMatrix(this.rotation.x),this.matrixRotation.multiplySelf(E.Matrix4.rotationYMatrix(this.rotation.y)),this.matrixRotation.multiplySelf(E.Matrix4.rotationZMatrix(this.rotation.z)),this.matrixScale=E.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.matrixRotation),this.matrix.multiplySelf(this.matrixScale)}},E.Particle=function(t){E.Object3D.call(this),this.material=t instanceof Array?t:[t],this.autoUpdateMatrix=!1},E.Particle.prototype=new E.Object3D,E.Particle.prototype.constructor=E.Particle,E.Line=function(t,n){E.Object3D.call(this),this.geometry=t,this.material=n instanceof Array?n:[n]},E.Line.prototype=new E.Object3D,E.Line.prototype.constructor=E.Line,E.Mesh=function(t,n,i){E.Object3D.call(this),this.geometry=t,this.material=n instanceof Array?n:[n],this.flipSided=!1,this.doubleSided=!1,this.overdraw=!1,this.materialFaceGroup={},this.sortFacesByMaterial(),i&&this.normalizeUVs(),this.geometry.computeBoundingBox()},E.Mesh.prototype=new E.Object3D,E.Mesh.prototype.constructor=E.Mesh,E.Mesh.prototype.sortFacesByMaterial=function(){var t,n,i,e,o,r,s;function a(i){for(s=[],t=0,n=i.length;t<n;t++)void 0==i[t]?s.push("undefined"):s.push(i[t].toString());return s.join("_")}for(i=0,e=this.geometry.faces.length;i<e;i++)o=this.geometry.faces[i],r=o.material,hash=a(r),void 0==this.materialFaceGroup[hash]&&(this.materialFaceGroup[hash]={faces:[],material:r}),this.materialFaceGroup[hash].faces.push(i)},E.Mesh.prototype.normalizeUVs=function(){var t,n,i,e,o;for(t=0,n=this.geometry.uvs.length;t<n;t++)for(o=this.geometry.uvs[t],i=0,e=o.length;i<e;i++)1!=o[i].u&&(o[i].u=o[i].u-Math.floor(o[i].u)),1!=o[i].v&&(o[i].v=o[i].v-Math.floor(o[i].v))},E.LineColorMaterial=function(t,n,i){this.lineWidth=i||1,this.color=new E.Color((n>=0?255*n<<24:4278190080)|t)},E.LineColorMaterial.prototype={toString:function(){return"THREE.LineColorMaterial ( color: "+this.color+", lineWidth: "+this.lineWidth+" )"}},E.MeshPhongMaterial=function(t,n,i,e,o){this.ambient=new E.Color((o>=0?255*o<<24:4278190080)|t),this.diffuse=new E.Color((o>=0?255*o<<24:4278190080)|n),this.specular=new E.Color((o>=0?255*o<<24:4278190080)|i),this.shininess=e,this.opacity=o,this.toString=function(){return"THREE.MeshPhongMaterial ( <br/>ambient: "+this.ambient+", <br/>diffuse: "+this.diffuse+", <br/>specular: "+this.specular+", <br/>shininess: "+this.shininess+", <br/>opacity: "+this.opacity+")"}},E.MeshBitmapMaterial=function(t,n){this.bitmap=t,this.mode=n||E.MeshBitmapMaterialMode.UVMAPPING,this.id=E.MeshBitmapMaterialCounter.value++,this.toString=function(){return"THREE.MeshBitmapMaterial ( bitmap: "+this.bitmap+", mode: "+this.mode+", id: "+this.id+" )"}},E.MeshBitmapMaterialCounter={value:0},E.MeshBitmapMaterialMode={UVMAPPING:0},E.MeshColorFillMaterial=function(t,n){this.color=new E.Color((n>=0?255*n<<24:4278190080)|t),this.toString=function(){return"THREE.MeshColorFillMaterial ( color: "+this.color+" )"}},E.MeshColorStrokeMaterial=function(t,n,i){this.lineWidth=i||1,this.color=new E.Color((n>=0?255*n<<24:4278190080)|t),this.toString=function(){return"THREE.MeshColorStrokeMaterial ( lineWidth: "+this.lineWidth+", color: "+this.color+" )"}},E.MeshFaceMaterial=function(){this.toString=function(){return"THREE.MeshFaceMaterial"}},E.ParticleBitmapMaterial=function(t){this.bitmap=t,this.offset=new E.Vector2,this.toString=function(){return"THREE.ParticleBitmapMaterial ( bitmap: "+this.bitmap+" )"}},E.ParticleCircleMaterial=function(t,n){this.color=new E.Color((n>=0?255*n<<24:4278190080)|t),this.toString=function(){return"THREE.ParticleCircleMaterial ( color: "+this.color+" )"}},E.ParticleDOMMaterial=function(t){this.domElement=t,this.toString=function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},E.Scene=function(){this.objects=[],this.lights=[],this.addObject=function(t){this.objects.push(t)},this.removeObject=function(t){for(var n=0,i=this.objects.length;n<i;n++)if(t==this.objects[n])return void this.objects.splice(n,1)},this.addLight=function(t){this.lights.push(t)},this.removeLight=function(t){for(var n=0,i=this.lights.length;n<i;n++)if(t==this.lights[n])return void this.lights.splice(n,1)},this.add=function(t){this.addObject(t)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},E.Projector=function(){var t,n,i,e,o,r,s,a,h=null,c=[],l=[],u=[],f=[],m=new E.Vector4,p=new E.Matrix4,d=new E.Matrix4;this.projectScene=function(g,y){var x,v,b,M,w,S,_,R,z,A,L,C,P,D,T,B,V,F,G;for(h=[],n=0,e=0,r=0,a=0,y.autoUpdateMatrix&&y.updateMatrix(),p.multiply(y.projectionMatrix,y.matrix),_=g.objects,x=0,v=_.length;x<v;x++)if(R=_[x],z=R.matrix,R.autoUpdateMatrix&&R.updateMatrix(),R instanceof E.Mesh){for(d.multiply(p,z),A=R.geometry.vertices,b=0,M=A.length;b<M;b++)L=A[b],C=L.positionScreen,C.copy(L.position),d.transform(C),L.__visible=C.z>0&&C.z<1;for(D=R.geometry.faces,w=0,S=D.length;w<S;w++)T=D[w],T instanceof E.Face3?(B=A[T.a],V=A[T.b],F=A[T.c],B.__visible&&V.__visible&&F.__visible&&(R.doubleSided||R.flipSided!=(F.positionScreen.x-B.positionScreen.x)*(V.positionScreen.y-B.positionScreen.y)-(F.positionScreen.y-B.positionScreen.y)*(V.positionScreen.x-B.positionScreen.x)<0)&&(t=c[n]=c[n]||new E.RenderableFace3,t.v1.copy(B.positionScreen),t.v2.copy(V.positionScreen),t.v3.copy(F.positionScreen),t.centroidWorld.copy(T.centroid),R.matrix.transform(t.centroidWorld),t.normalWorld.copy(T.normal),R.matrixRotation.transform(t.normalWorld),t.z=Math.max(B.positionScreen.z,Math.max(V.positionScreen.z,F.positionScreen.z)),t.meshMaterial=R.material,t.faceMaterial=T.material,t.overdraw=R.overdraw,t.uvs=R.geometry.uvs[w],t.color=T.color,h.push(t),n++)):T instanceof E.Face4&&(B=A[T.a],V=A[T.b],F=A[T.c],G=A[T.d],B.__visible&&V.__visible&&F.__visible&&G.__visible&&(R.doubleSided||R.flipSided!=((G.positionScreen.x-B.positionScreen.x)*(V.positionScreen.y-B.positionScreen.y)-(G.positionScreen.y-B.positionScreen.y)*(V.positionScreen.x-B.positionScreen.x)<0||(V.positionScreen.x-F.positionScreen.x)*(G.positionScreen.y-F.positionScreen.y)-(V.positionScreen.y-F.positionScreen.y)*(G.positionScreen.x-F.positionScreen.x)<0))&&(i=l[e]=l[e]||new E.RenderableFace4,i.v1.copy(B.positionScreen),i.v2.copy(V.positionScreen),i.v3.copy(F.positionScreen),i.v4.copy(G.positionScreen),i.centroidWorld.copy(T.centroid),R.matrix.transform(i.centroidWorld),i.normalWorld.copy(T.normal),R.matrixRotation.transform(i.normalWorld),i.z=Math.max(B.positionScreen.z,Math.max(V.positionScreen.z,Math.max(F.positionScreen.z,G.positionScreen.z))),i.meshMaterial=R.material,i.faceMaterial=T.material,i.overdraw=R.overdraw,i.uvs=R.geometry.uvs[w],i.color=T.color,h.push(i),e++))}else if(R instanceof E.Line)for(d.multiply(p,z),A=R.geometry.vertices,b=0,M=A.length;b<M;b++)L=A[b],C=L.positionScreen,C.copy(L.position),d.transform(C),L.__visible=C.z>0&&C.z<1,b>0&&(P=R.geometry.vertices[b-1],L.__visible&&P.__visible&&(o=u[r]=u[r]||new E.RenderableLine,o.v1.copy(L.positionScreen),o.v2.copy(P.positionScreen),o.z=Math.max(L.positionScreen.z,P.positionScreen.z),o.material=R.material,h.push(o),r++));else R instanceof E.Particle&&(m.set(R.position.x,R.position.y,R.position.z,1),y.matrix.transform(m),y.projectionMatrix.transform(m),R.screen.set(m.x/m.w,m.y/m.w,m.z/m.w),R.screen.z>0&&R.screen.z<1&&(s=f[a]=f[a]||new E.RenderableParticle,s.x=R.screen.x,s.y=R.screen.y,s.z=R.screen.z,s.rotation=R.rotation.z,s.scale.x=R.scale.x*Math.abs(m.x/m.w-(m.x+y.projectionMatrix.n11)/(m.w+y.projectionMatrix.n14)),s.scale.y=R.scale.y*Math.abs(m.y/m.w-(m.y+y.projectionMatrix.n22)/(m.w+y.projectionMatrix.n24)),s.material=R.material,s.color=R.color,h.push(s),a++));return h.sort((function(t,n){return n.z-t.z})),h}},E.DOMRenderer=function(){E.Renderer.call(this);var t,n,i,e,o=null,r=new E.Projector,s=document.createElement("div");this.domElement=s,this.setSize=function(o,r){t=o,n=r,i=t/2,e=n/2},this.render=function(t,n){var s,a,h,c,l,u,f,m,p;for(o=r.projectScene(t,n),s=0,a=o.length;s<a;s++)if(l=o[s],l instanceof E.RenderableParticle)for(m=l.x*i+i,p=l.y*e+e,h=0,c=l.material.length;h<c;h++)u=l.material[h],u instanceof E.ParticleDOMMaterial&&(f=u.domElement,f.style.left=m+"px",f.style.top=p+"px")}},E.CanvasRenderer=function(){var t,n,i,e,o=null,r=new E.Projector,s=document.createElement("canvas"),a=s.getContext("2d"),h=new E.Rectangle,c=new E.Rectangle,l=new E.Rectangle,u=!1,f=new E.Color(4294967295),m=new E.Color(4294967295),p=new E.Color(4294967295),d=2*Math.PI,g=new E.Vector2,y=new E.Vector3,x=new E.UV,v=new E.UV,b=new E.UV,M=new E.UV,w=new E.Vector2,S=new E.Vector2;function _(t,n){var i,e,o;for(n.setRGBA(1,1,1,1),i=0,e=t.lights.length;i<e;i++)o=t.lights[i],o instanceof E.AmbientLight&&(n.r*=o.color.r,n.g*=o.color.g,n.b*=o.color.b)}function R(t,n,i){var e,o,r;for(e=0,o=t.lights.length;e<o;e++)r=t.lights[e],r instanceof E.DirectionalLight?(i.r+=r.color.r,i.g+=r.color.g,i.b+=r.color.b):r instanceof E.PointLight&&(i.r+=r.color.r,i.g+=r.color.g,i.b+=r.color.b)}function z(t,n,i){var e,o,r,s;for(e=0,o=t.lights.length;e<o;e++)r=t.lights[e],r instanceof E.DirectionalLight?(s=n.normalWorld.dot(r.position)*r.intensity,s>0&&(i.r+=r.color.r*s,i.g+=r.color.g*s,i.b+=r.color.b*s)):r instanceof E.PointLight&&(y.sub(r.position,n.centroidWorld),y.normalize(),s=n.normalWorld.dot(y)*r.intensity,s>0&&(i.r+=r.color.r*s,i.g+=r.color.g*s,i.b+=r.color.b*s))}function A(t,n,o,r,s){var c,g,y,x,v,b,M,w,S;if(r instanceof E.ParticleCircleMaterial){if(u?(m.copyRGB(p),R(s,o,m),f.copyRGBA(r.color),f.multiplySelfRGB(m),f.updateStyleString()):f=r.color,c=o.scale.x*i,g=o.scale.y*e,l.set(t-c,n-g,t+c,n+g),!h.instersects(l))return;a.save(),a.translate(t,n),a.rotate(-o.rotation),a.scale(c,g),a.beginPath(),a.arc(0,0,1,0,d,!0),a.closePath(),a.fillStyle=f.__styleString,a.fill(),a.restore()}else if(r instanceof E.ParticleBitmapMaterial){if(M=r.bitmap,w=M.width/2,S=M.height/2,y=o.scale.x*i,x=o.scale.y*e,c=y*w,g=x*S,v=r.offset.x*y,b=r.offset.y*x,l.set(t+v-c,n+b-g,t+v+c,n+b+g),!h.instersects(l))return;a.save(),a.translate(t,n),a.rotate(-o.rotation),a.scale(y,-x),a.translate(-w+r.offset.x,-S-r.offset.y),a.drawImage(M,0,0),a.restore()}}function L(t,n,i,e,o,r,s){r instanceof E.LineColorMaterial&&(u?(m.copyRGB(p),R(s,o,m),f.copyRGBA(r.color),f.multiplySelfRGB(m),f.updateStyleString()):f=r.color,a.lineWidth=r.lineWidth,a.lineJoin="round",a.lineCap="round",a.strokeStyle=f.__styleString,a.stroke(),l.inflate(a.lineWidth))}function C(t,n,i,e,o,r,s,h,c){var d,g,y;h instanceof E.MeshColorFillMaterial?(u?(m.copyRGB(p),z(c,s,m),f.copyRGBA(h.color),f.multiplySelfRGB(m),f.updateStyleString()):f=h.color,a.beginPath(),a.moveTo(t,n),a.lineTo(i,e),a.lineTo(o,r),a.lineTo(t,n),a.closePath(),a.fillStyle=f.__styleString,a.fill()):h instanceof E.MeshColorStrokeMaterial?(u?(m.copyRGB(p),z(c,s,m),f.copyRGBA(h.color),f.multiplySelfRGB(m),f.updateStyleString()):f=h.color,a.beginPath(),a.moveTo(t,n),a.lineTo(i,e),a.lineTo(o,r),a.lineTo(t,n),a.closePath(),a.lineWidth=h.lineWidth,a.lineJoin="round",a.lineCap="round",a.strokeStyle=f.__styleString,a.stroke(),l.inflate(a.lineWidth)):h instanceof E.MeshBitmapMaterial&&(d=h.bitmap,g=d.width-1,y=d.height-1,x.copy(s.uvs[0]),v.copy(s.uvs[1]),b.copy(s.uvs[2]),x.u*=g,x.v*=y,v.u*=g,v.v*=y,b.u*=g,b.v*=y,D(d,t,n,i,e,o,r,x.u,x.v,v.u,v.v,b.u,b.v))}function P(t,n,i,e,o,r,s,h,c,d,g,y,w,S,_){var R,A,L;S instanceof E.MeshColorFillMaterial?(u?(m.copyRGB(p),z(_,w,m),f.copyRGBA(S.color),f.multiplySelfRGB(m),f.updateStyleString()):f=S.color,a.beginPath(),a.moveTo(t,n),a.lineTo(i,e),a.lineTo(o,r),a.lineTo(s,h),a.lineTo(t,n),a.closePath(),a.fillStyle=f.__styleString,a.fill()):S instanceof E.MeshColorStrokeMaterial?(u?(m.copyRGB(p),z(_,w,m),f.copyRGBA(S.color),f.multiplySelfRGB(m),f.updateStyleString()):f=S.color,a.beginPath(),a.moveTo(t,n),a.lineTo(i,e),a.lineTo(o,r),a.lineTo(s,h),a.lineTo(t,n),a.closePath(),a.lineWidth=S.lineWidth,a.lineJoin="round",a.lineCap="round",a.strokeStyle=f.__styleString,a.stroke(),l.inflate(a.lineWidth)):S instanceof E.MeshBitmapMaterial&&(R=S.bitmap,A=R.width-1,L=R.height-1,x.copy(w.uvs[0]),v.copy(w.uvs[1]),b.copy(w.uvs[2]),M.copy(w.uvs[3]),x.u*=A,x.v*=L,v.u*=A,v.v*=L,b.u*=A,b.v*=L,M.u*=A,M.v*=L,D(R,t,n,i,e,s,h,x.u,x.v,v.u,v.v,M.u,M.v),D(R,c,d,o,r,g,y,v.u,v.v,b.u,b.v,M.u,M.v))}function D(t,n,i,e,o,r,s,h,c,l,u,f,m){var p,d,g,y,x,v,b;a.beginPath(),a.moveTo(n,i),a.lineTo(e,o),a.lineTo(r,s),a.lineTo(n,i),a.closePath(),a.save(),a.clip(),p=h*(m-u)-l*m+f*u+(l-f)*c,d=-(c*(r-e)-u*r+m*e+(u-m)*n)/p,g=(u*s+c*(o-s)-m*o+(m-u)*i)/p,y=(h*(r-e)-l*r+f*e+(l-f)*n)/p,x=-(l*s+h*(o-s)-f*o+(f-l)*i)/p,v=(h*(m*e-u*r)+c*(l*r-f*e)+(f*u-l*m)*n)/p,b=(h*(m*o-u*s)+c*(l*s-f*o)+(f*u-l*m)*i)/p,a.transform(d,g,y,x,v,b),a.drawImage(t,0,0),a.restore()}function T(t,n){g.sub(n,t),g.unit(),g.multiplyScalar(.75),n.addSelf(g),t.subSelf(g)}this.domElement=s,this.autoClear=!0,this.setSize=function(o,r){t=o,n=r,i=t/2,e=n/2,s.width=t,s.height=n,h.set(-i,-e,i,e)},this.clear=function(){c.isEmpty()||(c.inflate(1),c.minSelf(h),a.setTransform(1,0,0,-1,i,e),a.clearRect(c.getX(),c.getY(),c.getWidth(),c.getHeight()),c.empty())},this.render=function(t,n){var s,f,m,d,g,y,x,v,b,M,R,z,D,B,V,F,G,U,W,j;for(this.autoClear&&this.clear(),o=r.projectScene(t,n),a.setTransform(1,0,0,-1,i,e),u=t.lights.length>0,u&&_(t,p),s=0,f=o.length;s<f;s++){if(m=o[s],l.empty(),m instanceof E.RenderableParticle)for(b=m.x*i,M=m.y*e,d=0,g=m.material.length;d<g;d++)v=m.material[d],A(b,M,m,v,t);else if(m instanceof E.RenderableLine){if(b=m.v1.x*i,M=m.v1.y*e,R=m.v2.x*i,z=m.v2.y*e,l.addPoint(b,M),l.addPoint(R,z),!h.instersects(l))continue;for(a.beginPath(),a.moveTo(b,M),a.lineTo(R,z),a.closePath(),d=0,g=m.material.length;d<g;d++)v=m.material[d],L(b,M,R,z,m,v,t)}else if(m instanceof E.RenderableFace3){if(m.v1.x*=i,m.v1.y*=e,m.v2.x*=i,m.v2.y*=e,m.v3.x*=i,m.v3.y*=e,m.overdraw&&(T(m.v1,m.v2),T(m.v2,m.v3),T(m.v3,m.v1)),b=m.v1.x,M=m.v1.y,R=m.v2.x,z=m.v2.y,D=m.v3.x,B=m.v3.y,l.addPoint(b,M),l.addPoint(R,z),l.addPoint(D,B),!h.instersects(l))continue;d=0,g=m.meshMaterial.length;while(d<g)if(v=m.meshMaterial[d++],v instanceof E.MeshFaceMaterial){y=0,x=m.faceMaterial.length;while(y<x)v=m.faceMaterial[y++],C(b,M,R,z,D,B,m,v,t)}else C(b,M,R,z,D,B,m,v,t)}else if(m instanceof E.RenderableFace4){if(m.v1.x*=i,m.v1.y*=e,m.v2.x*=i,m.v2.y*=e,m.v3.x*=i,m.v3.y*=e,m.v4.x*=i,m.v4.y*=e,w.copy(m.v2),S.copy(m.v4),m.overdraw&&(T(m.v1,m.v2),T(m.v2,m.v4),T(m.v4,m.v1)),b=m.v1.x,M=m.v1.y,R=m.v2.x,z=m.v2.y,V=m.v4.x,F=m.v4.y,m.overdraw&&(T(m.v3,w),T(m.v3,S)),D=m.v3.x,B=m.v3.y,G=w.x,U=w.y,W=S.x,j=S.y,l.addPoint(b,M),l.addPoint(R,z),l.addPoint(D,B),l.addPoint(V,F),!h.instersects(l))continue;d=0,g=m.meshMaterial.length;while(d<g)if(v=m.meshMaterial[d++],v instanceof E.MeshFaceMaterial){y=0,x=m.faceMaterial.length;while(y<x)v=m.faceMaterial[y++],P(b,M,R,z,D,B,V,F,G,U,W,j,m,v,t)}else P(b,M,R,z,D,B,V,F,G,U,W,j,m,v,t)}c.addRectangle(l)}a.setTransform(1,0,0,1,0,0)}},E.SVGRenderer=function(){var t,n,i,e,o,r,s,a=null,h=new E.Projector,c=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=new E.Rectangle,u=new E.Rectangle,f=!1,m=new E.Color(4294967295),p=new E.Color(4294967295),d=new E.Color(4294967295),g=new E.Vector3,y=[],x=[],v=1;function b(t,n){var i,e,o;for(n.setRGBA(1,1,1,1),i=0,e=t.lights.length;i<e;i++)o=t.lights[i],o instanceof E.AmbientLight&&(n.r*=o.color.r,n.g*=o.color.g,n.b*=o.color.b)}function M(t,n,i){var e,o,r;for(e=0,o=t.lights.length;e<o;e++)r=t.lights[e],r instanceof E.DirectionalLight?(i.r+=r.color.r,i.g+=r.color.g,i.b+=r.color.b):r instanceof E.PointLight&&(i.r+=r.color.r,i.g+=r.color.g,i.b+=r.color.b)}function w(t,n,i){var e,o,r,s;for(e=0,o=t.lights.length;e<o;e++)r=t.lights[e],r instanceof E.DirectionalLight?(s=n.normalWorld.dot(r.position)*r.intensity,s>0&&(i.r+=r.color.r*s,i.g+=r.color.g*s,i.b+=r.color.b*s)):r instanceof E.PointLight&&(g.sub(r.position,n.centroidWorld),g.normalize(),s=n.normalWorld.dot(g)*r.intensity,s>0&&(i.r+=r.color.r*s,i.g+=r.color.g*s,i.b+=r.color.b*s))}function S(t,n,e,r,a){o=A(s++),o.setAttribute("cx",t),o.setAttribute("cy",n),o.setAttribute("r",e.scale.x*i),r instanceof E.ParticleCircleMaterial&&(f?(p.copyRGB(d),M(a,e,p),m.copyRGBA(r.color),m.multiplySelfRGB(p),m.updateStyleString()):m=r.color,o.setAttribute("style","fill: "+m.__styleString)),c.appendChild(o)}function _(t,n,i,e,s,a,h,l,u){o=z(r++),o.setAttribute("d","M "+t+" "+n+" L "+i+" "+e+" L "+s+","+a+"z"),l instanceof E.MeshColorFillMaterial?(f?(p.copyRGB(d),w(u,h,p),m.copyRGBA(l.color),m.multiplySelfRGB(p),m.updateStyleString()):m=l.color,o.setAttribute("style","fill: "+m.__styleString)):l instanceof E.MeshColorStrokeMaterial&&(f?(p.copyRGB(d),w(u,h,p),m.copyRGBA(l.color),m.multiplySelfRGB(p),m.updateStyleString()):m=l.color,o.setAttribute("style","fill: none; stroke: "+m.__styleString+"; stroke-width: "+l.lineWidth+"; stroke-linecap: round; stroke-linejoin: round")),c.appendChild(o)}function R(t,n,i,e,s,a,h,l,u,g,y){o=z(r++),o.setAttribute("d","M "+t+" "+n+" L "+i+" "+e+" L "+s+","+a+" L "+h+","+l+"z"),g instanceof E.MeshColorFillMaterial?(f?(p.copyRGB(d),w(y,u,p),m.copyRGBA(g.color),m.multiplySelfRGB(p),m.updateStyleString()):m=g.color,o.setAttribute("style","fill: "+m.__styleString)):g instanceof E.MeshColorStrokeMaterial&&(f?(p.copyRGB(d),w(y,u,p),m.copyRGBA(g.color),m.multiplySelfRGB(p),m.updateStyleString()):m=g.color,o.setAttribute("style","fill: none; stroke: "+m.__styleString+"; stroke-width: "+g.lineWidth+"; stroke-linecap: round; stroke-linejoin: round")),c.appendChild(o)}function z(t){return null==y[t]?(y[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==v&&y[t].setAttribute("shape-rendering","crispEdges"),y[t]):y[t]}function A(t){return null==x[t]?(x[t]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==v&&x[t].setAttribute("shape-rendering","crispEdges"),x[t]):x[t]}this.domElement=c,this.autoClear=!0,this.setQuality=function(t){switch(t){case"high":v=1;break;case"low":v=0;break}},this.setSize=function(o,r){t=o,n=r,i=t/2,e=n/2,c.setAttribute("viewBox",-i+" "+-e+" "+t+" "+n),c.setAttribute("width",t),c.setAttribute("height",n),l.set(-i,-e,i,e)},this.clear=function(){while(c.childNodes.length>0)c.removeChild(c.childNodes[0])},this.render=function(t,n){var o,c,m,p,g,y,x,v,M,w,z,A,L,C,P,D;for(this.autoClear&&this.clear(),a=h.projectScene(t,n),r=0,s=0,f=t.lights.length>0,f&&b(t,d),o=0,c=a.length;o<c;o++)if(x=a[o],u.empty(),x instanceof E.RenderableParticle)for(M=x.x*i,w=x.y*-e,m=0,p=x.material.length;m<p;m++)v=x.material[m],S(M,w,x,v,t);else if(x instanceof E.RenderableFace3){if(M=x.v1.x*i,w=x.v1.y*-e,z=x.v2.x*i,A=x.v2.y*-e,L=x.v3.x*i,C=x.v3.y*-e,u.addPoint(M,w),u.addPoint(z,A),u.addPoint(L,C),!l.instersects(u))continue;m=0,p=x.meshMaterial.length;while(m<p)if(v=x.meshMaterial[m++],v instanceof E.MeshFaceMaterial){g=0,y=x.faceMaterial.length;while(g<y)v=x.faceMaterial[g++],_(M,w,z,A,L,C,x,v,t)}else _(M,w,z,A,L,C,x,v,t)}else if(x instanceof E.RenderableFace4){if(M=x.v1.x*i,w=x.v1.y*-e,z=x.v2.x*i,A=x.v2.y*-e,L=x.v3.x*i,C=x.v3.y*-e,P=x.v4.x*i,D=x.v4.y*-e,u.addPoint(M,w),u.addPoint(z,A),u.addPoint(L,C),u.addPoint(P,D),!l.instersects(u))continue;m=0,p=x.meshMaterial.length;while(m<p)if(v=x.meshMaterial[m++],v instanceof E.MeshFaceMaterial){g=0,y=x.faceMaterial.length;while(g<y)v=x.faceMaterial[g++],R(M,w,z,A,L,C,P,D,x,v,t)}else R(M,w,z,A,L,C,P,D,x,v,t)}}},E.WebGLRenderer=function(){var t,n,i,e=document.createElement("canvas"),o=new E.Matrix4,r=0,s=1,a=2,h=3;function c(){try{t=e.getContext("experimental-webgl",{antialias:!0})}catch(n){}if(!t)throw alert("WebGL not supported"),"cannot create webgl context";t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.clearColor(0,0,0,0)}function l(){n=t.createProgram(),t.attachShader(n,u("fragment",["#ifdef GL_ES","precision highp float;","#endif","uniform sampler2D diffuse;","uniform vec4 uniformColor;","varying vec2 vertexUv;","varying vec3 lightWeighting;","varying vec3 vNormal;","uniform int material;","uniform vec4 mAmbient;","uniform vec4 mDiffuse;","uniform vec4 mSpecular;","uniform float mShininess;","varying vec3 pLightVectorPoint;","varying vec3 pLightVectorDirection;","varying vec3 pViewPosition;","void main(){","if(material==3) { ","vec3 lightVectorPoint = normalize(pLightVectorPoint);","vec3 lightVectorDir = normalize(pLightVectorDirection);","vec3 normal = normalize(vNormal);","vec3 viewPosition = normalize(pViewPosition);","vec3 halfVectorPoint = normalize(pLightVectorPoint + pViewPosition);","float dotNormalHalfPoint = dot(normal, halfVectorPoint);","float ambientCompPoint = 1.0;","float diffuseCompPoint = max(dot(normal, lightVectorPoint), 0.0);","float specularCompPoint = pow(dotNormalHalfPoint, mShininess);","vec4 ambientPoint  = mAmbient * ambientCompPoint;","vec4 diffusePoint  = mDiffuse * diffuseCompPoint;","vec4 specularPoint = mSpecular * specularCompPoint;","vec3 halfVectorDir = normalize(pLightVectorDirection + pViewPosition);","float dotNormalHalfDir = dot(normal, halfVectorDir);","float ambientCompDir = 1.0;","float diffuseCompDir = max(dot(normal, lightVectorDir), 0.0);","float specularCompDir = pow(dotNormalHalfDir, mShininess);","vec4 ambientDir  = mAmbient * ambientCompDir;","vec4 diffuseDir  = mDiffuse * diffuseCompDir;","vec4 specularDir = mSpecular * specularCompDir;","vec4 pointLight = ambientPoint + diffusePoint + specularPoint;","vec4 dirLight = ambientDir + diffuseDir + specularDir;","gl_FragColor = vec4((pointLight.xyz + dirLight.xyz) * lightWeighting, 1.0);","} else if(material==2) {","vec4 texelColor = texture2D(diffuse, vertexUv);","gl_FragColor = vec4(texelColor.rgb * lightWeighting, texelColor.a);","} else if(material==1) {","gl_FragColor = vec4(uniformColor.rgb * lightWeighting, uniformColor.a);","} else {","gl_FragColor = vec4(uniformColor.rgb * lightWeighting, uniformColor.a);","}","}"].join("\n"))),t.attachShader(n,u("vertex",["attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","uniform bool enableLighting;","uniform vec3 ambientColor;","uniform vec3 directionalColor;","uniform vec3 lightingDirection;","uniform vec3 pointColor;","uniform vec3 pointPosition;","uniform mat4 objMatrix;","uniform mat4 viewMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat3 normalMatrix;","varying vec4 vertexColor;","varying vec2 vertexUv;","varying vec3 lightWeighting;","varying vec3 vNormal;","varying vec3 pLightVectorPoint;","varying vec3 pLightVectorDirection;","varying vec3 pViewPosition;","uniform vec3 cameraPosition;","void main(void) {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 transformedNormal = normalize(normalMatrix * normal);","vec4 lPosition = viewMatrix * vec4( pointPosition, 1.0 );","vec4 lDirection = viewMatrix * vec4( lightingDirection, 0.0 );","pLightVectorPoint = normalize(pointPosition.xyz - position.xyz);","pLightVectorDirection = normalize(lDirection.xyz);","vec4 mPosition = objMatrix * vec4( position, 1.0 );","pViewPosition = cameraPosition - mPosition.xyz;","if(!enableLighting) {","lightWeighting = vec3(1.0, 1.0, 1.0);","} else {","vec3 pointLight = normalize(lPosition.xyz - mvPosition.xyz);","float directionalLightWeighting = max(dot(transformedNormal, normalize(lDirection.xyz)), 0.0);","float pointLightWeighting = max(dot(transformedNormal, pointLight), 0.0);","lightWeighting = ambientColor + directionalColor * directionalLightWeighting + pointColor * pointLightWeighting;","}","vNormal = transformedNormal;","vertexUv = uv;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"))),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||alert("Could not initialise shaders"),t.useProgram(n),n.viewMatrix=t.getUniformLocation(n,"viewMatrix"),n.modelViewMatrix=t.getUniformLocation(n,"modelViewMatrix"),n.projectionMatrix=t.getUniformLocation(n,"projectionMatrix"),n.normalMatrix=t.getUniformLocation(n,"normalMatrix"),n.objMatrix=t.getUniformLocation(n,"objMatrix"),n.enableLighting=t.getUniformLocation(n,"enableLighting"),n.ambientColor=t.getUniformLocation(n,"ambientColor"),n.directionalColor=t.getUniformLocation(n,"directionalColor"),n.lightingDirection=t.getUniformLocation(n,"lightingDirection"),n.pointColor=t.getUniformLocation(n,"pointColor"),n.pointPosition=t.getUniformLocation(n,"pointPosition"),n.material=t.getUniformLocation(n,"material"),n.uniformColor=t.getUniformLocation(n,"uniformColor"),n.mAmbient=t.getUniformLocation(n,"mAmbient"),n.mDiffuse=t.getUniformLocation(n,"mDiffuse"),n.mSpecular=t.getUniformLocation(n,"mSpecular"),n.mShininess=t.getUniformLocation(n,"mShininess"),n.cameraPosition=t.getUniformLocation(n,"cameraPosition"),n.position=t.getAttribLocation(n,"position"),t.enableVertexAttribArray(n.position),n.normal=t.getAttribLocation(n,"normal"),t.enableVertexAttribArray(n.normal),n.uv=t.getAttribLocation(n,"uv"),t.enableVertexAttribArray(n.uv),n.diffuse=t.getUniformLocation(n,"diffuse"),t.uniform1i(n.diffuse,0),n.viewMatrixArray=new Float32Array(16),n.modelViewMatrixArray=new Float32Array(16),n.projectionMatrixArray=new Float32Array(16)}function u(n,i){var e;return"fragment"==n?e=t.createShader(t.FRAGMENT_SHADER):"vertex"==n&&(e=t.createShader(t.VERTEX_SHADER)),t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(alert(t.getShaderInfoLog(e)),null)}this.domElement=e,this.autoClear=!0,c(),l(),this.setSize=function(n,i){e.width=n,e.height=i,t.viewport(0,0,e.width,e.height)},this.clear=function(){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},this.setupLights=function(i){var e,o,r,s,a,h;for(t.uniform1i(n.enableLighting,i.lights.length),e=0,o=i.lights.length;e<o;e++)h=i.lights[e],h instanceof E.AmbientLight?(r=h.color,t.uniform3f(n.ambientColor,r.r,r.g,r.b)):h instanceof E.DirectionalLight?(r=h.color,s=h.position,a=h.intensity,t.uniform3f(n.lightingDirection,s.x,s.y,s.z),t.uniform3f(n.directionalColor,r.r*a,r.g*a,r.b*a)):h instanceof E.PointLight&&(r=h.color,s=h.position,a=h.intensity,t.uniform3f(n.pointPosition,s.x,s.y,s.z),t.uniform3f(n.pointColor,r.r*a,r.g*a,r.b*a))},this.createBuffers=function(n,i){var e,o,r,s,a,h,c,l,u,f,m,p=n.materialFaceGroup[i],d=[],g=[],y=[],x=[],v=[],b=0;for(e=0,o=p.faces.length;e<o;e++)r=p.faces[e],s=n.geometry.faces[r],a=s.vertexNormals,h=s.normal,c=n.geometry.uvs[r],s instanceof E.Face3?(l=n.geometry.vertices[s.a].position,u=n.geometry.vertices[s.b].position,f=n.geometry.vertices[s.c].position,y.push(l.x,l.y,l.z),y.push(u.x,u.y,u.z),y.push(f.x,f.y,f.z),3==a.length?(x.push(a[0].x,a[0].y,a[0].z),x.push(a[1].x,a[1].y,a[1].z),x.push(a[2].x,a[2].y,a[2].z)):(x.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z)),c&&(v.push(c[0].u,c[0].v),v.push(c[1].u,c[1].v),v.push(c[2].u,c[2].v)),d.push(b,b+1,b+2),g.push(b,b+1),g.push(b,b+2),g.push(b+1,b+2),b+=3):s instanceof E.Face4&&(l=n.geometry.vertices[s.a].position,u=n.geometry.vertices[s.b].position,f=n.geometry.vertices[s.c].position,m=n.geometry.vertices[s.d].position,y.push(l.x,l.y,l.z),y.push(u.x,u.y,u.z),y.push(f.x,f.y,f.z),y.push(m.x,m.y,m.z),4==a.length?(x.push(a[0].x,a[0].y,a[0].z),x.push(a[1].x,a[1].y,a[1].z),x.push(a[2].x,a[2].y,a[2].z),x.push(a[3].x,a[3].y,a[3].z)):(x.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z)),c&&(v.push(c[0].u,c[0].v),v.push(c[1].u,c[1].v),v.push(c[2].u,c[2].v),v.push(c[3].u,c[3].v)),d.push(b,b+1,b+2),d.push(b,b+2,b+3),g.push(b,b+1),g.push(b,b+2),g.push(b,b+3),g.push(b+1,b+2),g.push(b+2,b+3),b+=4);y.length&&(p.__webGLVertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.__webGLVertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(y),t.STATIC_DRAW),p.__webGLNormalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.__webGLNormalBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(x),t.STATIC_DRAW),p.__webGLUVBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.__webGLUVBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(v),t.STATIC_DRAW),p.__webGLFaceBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,p.__webGLFaceBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),t.STATIC_DRAW),p.__webGLLineBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,p.__webGLLineBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),t.STATIC_DRAW),p.__webGLFaceCount=d.length,p.__webGLLineCount=g.length)},this.renderBuffer=function(i,e){i instanceof E.MeshPhongMaterial?(mAmbient=i.ambient,mDiffuse=i.diffuse,mSpecular=i.specular,t.uniform4f(n.mAmbient,mAmbient.r,mAmbient.g,mAmbient.b,i.opacity),t.uniform4f(n.mDiffuse,mDiffuse.r,mDiffuse.g,mDiffuse.b,i.opacity),t.uniform4f(n.mSpecular,mSpecular.r,mSpecular.g,mSpecular.b,i.opacity),t.uniform1f(n.mShininess,i.shininess),t.uniform1i(n.material,h)):i instanceof E.MeshColorFillMaterial?(color=i.color,t.uniform4f(n.uniformColor,color.r*color.a,color.g*color.a,color.b*color.a,color.a),t.uniform1i(n.material,r)):i instanceof E.MeshColorStrokeMaterial?(lineWidth=i.lineWidth,color=i.color,t.uniform4f(n.uniformColor,color.r*color.a,color.g*color.a,color.b*color.a,color.a),t.uniform1i(n.material,s)):i instanceof E.MeshBitmapMaterial&&(!i.__webGLTexture&&i.loaded&&(i.__webGLTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i.__webGLTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.bitmap),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameterCanvasRendereri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i.__webGLTexture),t.uniform1i(n.diffuse,0),t.uniform1i(n.material,a)),t.bindBuffer(t.ARRAY_BUFFER,e.__webGLVertexBuffer),t.vertexAttribPointer(n.position,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e.__webGLNormalBuffer),t.vertexAttribPointer(n.normal,3,t.FLOAT,!1,0,0),i instanceof E.MeshBitmapMaterial?(t.bindBuffer(t.ARRAY_BUFFER,e.__webGLUVBuffer),t.enableVertexAttribArray(n.uv),t.vertexAttribPointer(n.uv,2,t.FLOAT,!1,0,0)):t.disableVertexAttribArray(n.uv),i instanceof E.MeshBitmapMaterial||i instanceof E.MeshColorFillMaterial||i instanceof E.MeshPhongMaterial?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.__webGLFaceBuffer),t.drawElements(t.TRIANGLES,e.__webGLFaceCount,t.UNSIGNED_SHORT,0)):i instanceof E.MeshColorStrokeMaterial&&(t.lineWidth(lineWidth),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.__webGLLineBuffer),t.drawElements(t.LINES,e.__webGLLineCount,t.UNSIGNED_SHORT,0))},this.renderMesh=function(t,n){var i,e,o,r,s,a,h,c;for(s in t.materialFaceGroup)for(c=t.materialFaceGroup[s],c.__webGLVertexBuffer||this.createBuffers(t,s),o=0,r=t.material.length;o<r;o++)if(h=t.material[o],h instanceof E.MeshFaceMaterial)for(i=0,e=c.material.length;i<e;i++)a=c.material[i],this.renderBuffer(a,c);else a=h,this.renderBuffer(a,c)},this.setupMatrices=function(e,r){e.autoUpdateMatrix&&e.updateMatrix(),o.multiply(r.matrix,e.matrix),n.viewMatrixArray=new Float32Array(r.matrix.flatten()),n.modelViewMatrixArray=new Float32Array(o.flatten()),n.projectionMatrixArray=new Float32Array(r.projectionMatrix.flatten()),i=E.Matrix4.makeInvert3x3(o).transpose(),n.normalMatrixArray=new Float32Array(i.m),t.uniformMatrix4fv(n.viewMatrix,!1,n.viewMatrixArray),t.uniformMatrix4fv(n.modelViewMatrix,!1,n.modelViewMatrixArray),t.uniformMatrix4fv(n.projectionMatrix,!1,n.projectionMatrixArray),t.uniformMatrix3fv(n.normalMatrix,!1,n.normalMatrixArray),t.uniformMatrix4fv(n.objMatrix,!1,new Float32Array(e.matrix.flatten()))},this.render=function(i,e){var o,r,s;for(this.autoClear&&this.clear(),e.autoUpdateMatrix&&e.updateMatrix(),t.uniform3f(n.cameraPosition,e.position.x,e.position.y,e.position.z),this.setupLights(i),o=0,r=i.objects.length;o<r;o++)s=i.objects[o],this.setupMatrices(s,e),s instanceof E.Mesh?this.renderMesh(s,e):s instanceof E.Line||E.Particle}},E.RenderableFace3=function(){this.v1=new E.Vector2,this.v2=new E.Vector2,this.v3=new E.Vector2,this.centroidWorld=new E.Vector3,this.normalWorld=new E.Vector3,this.z=null,this.color=null,this.material=null},E.RenderableFace4=function(){this.v1=new E.Vector2,this.v2=new E.Vector2,this.v3=new E.Vector2,this.v4=new E.Vector2,this.centroidWorld=new E.Vector3,this.normalWorld=new E.Vector3,this.z=null,this.color=null,this.material=null},E.RenderableParticle=function(){this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new E.Vector2,this.color=null,this.material=null},E.RenderableLine=function(){this.v1=new E.Vector2,this.v2=new E.Vector2,this.z=null,this.color=null,this.material=null};var D=E,T={name:"PageAbout",data:function(){return{}},methods:{liziInit:function(){var t,n,i,e,o,r,s,a=window.innerWidth,h=window.innerHeight,c=90,l=50,u=50,f=0,m=window.innerWidth/2,p=window.innerHeight/2;function d(){t=document.createElement("div"),t.style.position="relative",t.style.top="200px",document.getElementById("indexLizi").appendChild(t),o=new D.Camera(75,a/h,1,1e4),o.position.z=1e3,r=new D.Scene,s=new D.CanvasRenderer,s.setSize(a,h),n=new Array;for(var f=0,m=new D.ParticleCircleMaterial(621531,1),p=0;p<l;p++)for(var d=0;d<u;d++)i=n[f++]=new D.Particle(m),i.position.x=p*c-l*c/2,i.position.z=d*c-u*c/2,r.add(i);e=0,t.appendChild(s.domElement),document.addEventListener("mousemove",x,!1),document.addEventListener("touchmove",v,!1)}d(),this.interval=setInterval(b,25);var g=null;function y(t){window.clearTimeout(g),f=t.clientX-m,t.clientY-p,g=null}function x(t){g||(g=window.setTimeout(y,50,t))}function v(t){1==t.touches.length&&(t.preventDefault(),f=t.touches[0].pageX-m,t.touches[0].pageY-p)}function b(){o.position.x+=.05*(f-o.position.x),o.position.y=364;for(var t=0,a=0;a<l;a++)for(var h=0;h<u;h++)i=n[t++],i.position.y=50*Math.sin(.3*(a+e))+50*Math.sin(.5*(h+e)),i.scale.x=i.scale.y=2*(Math.sin(.3*(a+e))+1)+2*(Math.sin(.5*(h+e))+1);s.render(r,o),e+=.1}}},mounted:function(){this.liziInit()},beforeDestroy:function(){this.interval&&clearInterval(this.interval)}},B=T,V=Object(s["a"])(B,C,P,!1,null,null,null),F=V.exports;e["a"].use(l["a"]);var G=new l["a"]({routes:[{path:"/",component:g,children:[{path:"",name:"home",component:w},{path:"/magic_cube",name:"/magicCube",component:L},{path:"/about",name:"about",component:F}]}]}),U=i("2f62");e["a"].use(U["a"]);var W=new U["a"].Store({state:{},mutations:{},actions:{}}),j=i("9483");Object(j["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});i("a4ac"),i("e54f");var I=i("b05d"),k=i("4d5a"),O=i("9898"),N=i("f2cc"),q=i("c7a0"),H=i("2ea3"),Y=i("65c6"),X=i("6ac5"),Q=i("9c40"),$=i("0016"),J=i("497d"),Z=i("6ab5"),K=i("033f"),tt=i("e208"),nt=i("d66b"),it=i("8169"),et=i("f09f"),ot=i("2a19"),rt=i("27f9"),st=i("436b"),at=i("24e8"),ht=i("74f7"),ct=i("a403"),lt=i("f508");e["a"].use(I["a"],{config:{animations:"all"},components:{QLayout:k["a"],QHeader:O["a"],QDrawer:N["a"],QPageContainer:q["a"],QPage:H["a"],QToolbar:Y["a"],QToolbarTitle:X["a"],QBtn:Q["a"],QIcon:$["a"],QList:J["a"],QItem:Z["a"],QItemSection:K["a"],QItemLabel:tt["a"],QEditor:nt["a"],QChatMessage:it["a"],QCard:et["a"],QInput:rt["a"],QDialog:at["a"],QInnerLoading:ht["a"],QSpinnerBall:ct["a"]},directives:{},plugins:{Notify:ot["a"],Dialog:st["a"],Loading:lt["a"]}}),e["a"].config.productionTip=!1,new e["a"]({router:G,store:W,render:function(t){return t(c)}}).$mount("#app")},a4ac:function(t,n,i){},a9a9:function(t,n,i){"use strict";var e=i("bedb"),o=i.n(e);o.a},bedb:function(t,n,i){},c25a:function(t,n,i){"use strict";var e=i("ec95"),o=i.n(e);o.a},ec95:function(t,n,i){}});
//# sourceMappingURL=app.ad724e73.js.map